<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Vinícius dos Santos Oliveira">
<title>Boost.Http</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Boost.Http</h1>
<div class="details">
<span id="author" class="author">Vinícius dos Santos Oliveira</span><br>
<span id="email" class="email"><a href="mailto:vini.ipsmaker@gmail.com">vini.ipsmaker@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using">1. Using</a>
<ul class="sectlevel2">
<li><a href="#_requirements">1.1. Requirements</a></li>
</ul>
</li>
<li><a href="#_tutorial">2. Tutorial</a>
<ul class="sectlevel2">
<li><a href="#parsing_tutorial1">2.1. Parsing (beginner)</a></li>
<li><a href="#parsing_tutorial2">2.2. Parsing (advanced)</a></li>
<li><a href="#parsing_tutorial3">2.3. Parsing HTTP upgrade</a></li>
<li><a href="#_implementing_boost_beast_parser_interface">2.4. Implementing Boost.Beast parser interface</a></li>
</ul>
</li>
<li><a href="#design_choices">3. Design choices</a>
<ul class="sectlevel2">
<li><a href="#_faq">3.1. FAQ</a></li>
<li><a href="#_roadmap">3.2. Roadmap</a></li>
</ul>
</li>
<li><a href="#_reference">4. Reference</a>
<ul class="sectlevel2">
<li><a href="#_summary">4.1. Summary</a></li>
<li><a href="#_detailed">4.2. Detailed</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Distributed under the Boost Software License, Version 1.0. (See accompanying
file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" class="bare">http://www.boost.org/LICENSE_1_0.txt</a>)</p>
</div>
<div class="paragraph">
<p>This library can be used to create applications that need to parse HTTP streams.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is not an official Boost C++ library. It wasn&#8217;t reviewed and can&#8217;t
be downloaded from www.boost.org. This library will be reviewed eventually.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Boost.Http is a library that provides an incremental HTTP parser and a set of
mini-parsers that can be used independently or combined <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>. A future version will also provide a message generator.</p>
</div>
<div class="paragraph">
<p>The highlights are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for modern HTTP features.</p>
</li>
<li>
<p>Simple.</p>
</li>
<li>
<p>Portable (C++03 and very few other dependencies).</p>
</li>
<li>
<p>Just like Ryan Dahl&#8217;s HTTP parser, this parser does not make any syscalls or
allocations. It also does not buffer data.</p>
</li>
<li>
<p>You can mutate the passed buffer <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>.</p>
</li>
<li>
<p>It doesn&#8217;t steal control flow from your application <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>. Great for HTTP
pipelining.</p>
</li>
<li>
<p>Matching and decoding tokens as separate steps <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using">1. Using</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">1.1. Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>CMake 3.1.0 or newer <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup>. You can skip this requirement if
you don&#8217;t intend to run the tests.</p>
</li>
<li>
<p>Boost 1.57 or more recent.</p>
<div class="ulist">
<ul>
<li>
<p><code>boost::asio::const_buffer</code>.</p>
</li>
<li>
<p><code>boost::string_ref</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://asciidoctor.org/">asciidoctor</a> <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup>. You&#8217;ll
also need <a href="http://pandoc.org/">pandoc</a> if you want to generate the ePUB output.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial">2. Tutorial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="parsing_tutorial1">2.1. Parsing (beginner)</h3>
<div class="paragraph">
<p>In this tutorial, you&#8217;ll learn how to use this library to parse HTTP streams
easily.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We assume the reader has basic understanding of C++ and Boost.Asio.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We start with the code that should resemble the structure of the program you&#8217;re
about to code. And this structure is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/reader/request.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;string&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;map&gt;</span><span class="tok-cp"></span>

<span class="tok-k">namespace</span> <span class="tok-n">http</span> <span class="tok-o">=</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-p">;</span>
<span class="tok-k">namespace</span> <span class="tok-n">asio</span> <span class="tok-o">=</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-p">;</span>

<span class="tok-k">struct</span> <span class="tok-n">my_socket_consumer</span>
<span class="tok-p">{</span>
<span class="tok-k">private</span><span class="tok-o">:</span>
    <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">reader</span><span class="tok-o">::</span><span class="tok-n">request</span> <span class="tok-n">request_reader</span><span class="tok-p">;</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">buffer</span><span class="tok-p">;</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">last_header</span><span class="tok-p">;</span>

<span class="tok-k">public</span><span class="tok-o">:</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">method</span><span class="tok-p">;</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">request_target</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">version</span><span class="tok-p">;</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">multimap</span><span class="tok-o">&lt;</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-o">&gt;</span> <span class="tok-n">headers</span><span class="tok-p">;</span>

    <span class="tok-kt">void</span> <span class="tok-nf">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
        <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

        <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

        <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
                <span class="tok-c1">// do nothing</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
                <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
                <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
                <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
                <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-p">}</span>
            <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>

        <span class="tok-n">ready</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

<span class="tok-k">protected</span><span class="tok-o">:</span>
    <span class="tok-k">virtual</span> <span class="tok-kt">void</span> <span class="tok-n">ready</span><span class="tok-p">()</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re building a piece of code that consumes HTTP from somewhere — the in — and
spits it out in the form of C++ structured data to somewhere else — the out.</p>
</div>
<div class="paragraph">
<p>The <em>in</em> of your program is connected to the above piece of code through the
<code>on_socket_callback</code> member function. The <em>out</em> of your program is connected to
the previous piece of code through the <code>ready</code> overrideable member-function.</p>
</div>
<div class="paragraph">
<p>By now I shouldn&#8217;t be worried about your understanding of how you&#8217;ll connect the
network I/O with the <em>in</em> of the program. The connection point is obvious
by now. However, I&#8217;ll briefly explain the <em>out</em> connection point and then we can
proceed to delve into the <em>inout</em>-inbetween (Danas) part of the program.</p>
</div>
<div class="paragraph">
<p>Once the <code>ready</code> member function is called, the data for your request will be
available in the <code>method</code>, <code>request_target</code> and the other <em>public</em>
variables. From now on, I&#8217;ll focus my attention to the sole implementation of
<code>my_socket_consumer::on_socket_callback</code>.</p>
</div>
<div class="listingblock">
<div class="title">The awaited prize</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-c1">//http::reader::request request_reader;</span>
    <span class="tok-c1">//std::string buffer;</span>
    <span class="tok-c1">//std::string last_header;</span>

    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-c1">// do nothing</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Try to keep in mind the three variables that will really orchestrate the flow:
<code>request_reader</code>, <code>buffer</code> and <code>last_header</code>.</p>
</div>
<div class="paragraph">
<p>The whole work is about managing the buffer and managing the tokens.</p>
</div>
<div class="paragraph">
<p>The token access is very easy. As the parser is incremental, there is only one
token at a time. I don&#8217;t need to explain Boost.Http control-flow because the
control flow will be coded by you (a library, not a framework). You only have to
use <code>code()</code> to check the current token and <code>value&lt;T&gt;()</code> to extract its value.
Use <code>next()</code> to advance a token.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is only one caveat. The parser doesn&#8217;t buffer data and will decode the
token into a value (the <code>value&lt;T&gt;()</code> member function) directly from the buffer
data.</p>
</div>
<div class="paragraph">
<p>This means you cannot extract the current value once you drop current buffer
data. As a nice side effect, you spare CPU time for the tokens you do not need
to decode (match&#8217;n&#8217;decoding as separate steps).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parser doesn&#8217;t buffer data, which means when we use the <code>set_buffer</code> member
function, <code>request_reader</code> only maintains a <strong>view</strong> to the passed buffer, which
we&#8217;ll refer to as the virtual buffer from now on.</p>
</div>
<div class="paragraph">
<p>In the virtual buffer, there is head/current and remaining/tail.
<code>request_reader</code> doesn&#8217;t store a pointer/address/index to the real buffer. Once
a token is consumed, his bytes (head) are discarded from the virtual
buffer. When you mutate the real buffer, the virtual buffer is invalidated and
you must inform the parser using <code>set_buffer</code>. However, the bytes discarded from
the virtual buffer shouldn&#8217;t appear again. You must keep track of the number of
discarded bytes to prepare the buffer to the next call to <code>set_buffer</code>. The
previous code doesn&#8217;t handle that.</p>
</div>
<div class="paragraph">
<p>The new tool that you should be presented now is <code>token_size()</code>. <code>token_size()</code>
will return the size in bytes of current/head.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
There is no guarantee <code>token_size()</code> returns the same size as returned
by <code>string_length(request_reader.value&lt;T&gt;())</code>. You <strong>need</strong> to use
<code>token_size()</code> to compute the number of discarded bytes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-c1">//&lt; NEW</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-c1">// do nothing</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span> <span class="tok-c1">//&lt; NEW</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span> <span class="tok-c1">//&lt; NEW</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>nparsed</code> was easy. However, the <code>while(request_reader.code() !=
code::end_of_message)</code> doesn&#8217;t seem right. It&#8217;s very error-prone to assume the
full HTTP message will be ready in a single call to <code>on_socket_callback</code>. Error
handling must be introduced in the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span> <span class="tok-c1">//&lt; NEW</span>
           <span class="tok-o">&amp;&amp;</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-c1">// do nothing</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">return</span><span class="tok-p">;</span> <span class="tok-c1">//&lt; NEW</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Don&#8217;t worry about <code>token_size(code::error_insufficient_data)</code> being added
to <code>nparsed</code>. This (error) "token" is defined to be 0-size (it fits perfectly
with the other rules).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just because it&#8217;s easy and we&#8217;re already at it, let&#8217;s handle the other errors as
well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span>
           <span class="tok-o">&amp;&amp;</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_set_method</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_use_another_connection</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-c1">// Can only happen in response parsing code.</span>
            <span class="tok-n">assert</span><span class="tok-p">(</span><span class="tok-nb">false</span><span class="tok-p">);</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_data</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_no_host</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_content_length</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_content_length_overflow</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_transfer_encoding</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_chunk_size_overflow</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-k">throw</span> <span class="tok-s">&quot;invalid HTTP data&quot;</span><span class="tok-p">;</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-c1">// do nothing</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And buffer management is complete. However, the code only demonstrated how to
extract simple tokens. Field name and field value are simple tokens, but they
are usually tied together into a complex structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span>
           <span class="tok-o">&amp;&amp;</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-c1">// ...</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_value</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-c1">// NEW</span>
            <span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">emplace</span><span class="tok-p">(</span><span class="tok-n">last_header</span><span class="tok-p">,</span>
                            <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>last_header</code> did the trick. Easy, but maybe we want to separate headers and
trailers (the HTTP headers that are sent <em>after</em> the message body). This task
can be accomplished by the use of structural tokens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-c1">// NEW:</span>
    <span class="tok-c1">// We have to declare `bool my_socket_consumer::use_trailers = false` and</span>
    <span class="tok-c1">// `std::multimap&lt;std::string, std::string&gt; my_socket_consumer::trailers`.</span>

    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span>
           <span class="tok-o">&amp;&amp;</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-c1">// ...</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_value</span><span class="tok-p">:</span>
            <span class="tok-c1">// NEW</span>
            <span class="tok-p">(</span><span class="tok-n">use_trailers</span> <span class="tok-o">?</span> <span class="tok-nl">trailers</span> <span class="tok-p">:</span> <span class="tok-n">headers</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-n">emplace</span><span class="tok-p">(</span><span class="tok-n">last_header</span><span class="tok-p">,</span>
                         <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_headers</span><span class="tok-p">:</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-n">use_trailers</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Maybe you had a gut feeling and thought that the previous code was too
strange. If <code>trailer_name</code> is a separate token, why don&#8217;t we use
<code>request_reader.value&lt;token::trailer_name&gt;()</code> (same to <code>trailer_value</code>) and go
away with structural tokens?</p>
</div>
<div class="paragraph">
<p>Yes, I unnecessarily complicated the code here to introduce you the concept of
structural tokens. They are very important and usually you&#8217;ll end up using
them. Maybe this tutorial needs some revamping after the library evolved a few
times.</p>
</div>
<div class="paragraph">
<p>Also notice that here you can use either
<code>request_reader.value&lt;token::field_name&gt;()</code> or
<code>request_reader.value&lt;token::trailer_name&gt;()</code> to extract this token value. It is
as if <code>trailer_name</code> is “implicitly convertible” to <code>field_name</code>, so to speak.
This feature makes the life of users who don&#8217;t need to differentiate headers and
trailers much easier (with no drawback to the users who do need to differentiate
them).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some of the structural tokens' properties are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No <code>value&lt;T&gt;()</code> associated. <code>value&lt;T&gt;()</code> extraction is a property exclusive of
the <em>data</em> tokens.</p>
</li>
<li>
<p>It might be 0-sized.</p>
</li>
<li>
<p>They are always emitted (e.g. <code>code::end_of_body</code> will be emitted before
<code>code::end_of_message</code> even if no <code>code::body_chunk</code> is present).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We were using the <code>code::end_of_message</code> structural token since the initial
version of the code, so they aren&#8217;t completely alien. However, we were ignoring
one very important HTTP parsing feature for this time. It&#8217;s the last missing bit
before your understanding to use this library is complete. Our current code
lacks the ability to handle HTTP pipelining.</p>
</div>
<div class="paragraph">
<p>HTTP pipelining is the feature that allows HTTP clients to send HTTP requests
“in batch”. In other words, they may send several requests at once over the same
connection before the server creates a response to them. If the previous code
faces this situation, it&#8217;ll stop parsing on the first request and possibly wait
forever until the <code>on_socket_callback</code> is called again with more data (yeap,
networking code can be hard with so many little details).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">my_socket_consumer</span><span class="tok-o">::</span><span class="tok-n">on_socket_callback</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">data</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-p">;</span>
    <span class="tok-k">using</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">;</span>

    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">);</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span>
           <span class="tok-o">&amp;&amp;</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-c1">// ...</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">use_trailers</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">//&lt; NEW</span>
            <span class="tok-n">trailers</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span> <span class="tok-c1">//&lt; NEW</span>

            <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">request_target</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_value</span><span class="tok-p">:</span>
            <span class="tok-p">(</span><span class="tok-n">use_trailers</span> <span class="tok-o">?</span> <span class="tok-nl">trailers</span> <span class="tok-p">:</span> <span class="tok-n">headers</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-n">emplace</span><span class="tok-p">(</span><span class="tok-n">last_header</span><span class="tok-p">,</span>
                         <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_headers</span><span class="tok-p">:</span>
            <span class="tok-n">use_trailers</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">request_reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>

    <span class="tok-n">ready</span><span class="tok-p">();</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-c1">//&lt; NEW</span>
        <span class="tok-n">on_socket_callback</span><span class="tok-p">();</span> <span class="tok-c1">//&lt; NEW</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are HTTP libraries that could adopt a “synchronous” approach where the
user must immediately give a HTTP response once the <code>ready()</code> callback is called
so the parsing code can parse the whole buffer until the end and we could just
put the <code>ready()</code> call into the <code>code::end_of_message</code> case.</p>
</div>
<div class="paragraph">
<p>There are HTTP libraries that follow ASIO active style and we expect the user to
call something like <code>async_read_request</code> before it can read the next request. In
this case, the solution for HTTP pipelining would be different.</p>
</div>
<div class="paragraph">
<p>There are libraries that don&#8217;t follow ASIO style, but don&#8217;t force the user to
send HTTP responses immediately on the <code>ready()</code> callback. In such cases,
synchronization/coordination of the response generation by the user and parse
resuming by the library is necessary.</p>
</div>
<div class="paragraph">
<p>This point can be rather diverse and the code for this tutorial only shows a
rather quick&#8217;n&#8217;dirty solution. Any different solution to keep the parsing train
at full-speed is left as an exercise to the reader.</p>
</div>
<div class="paragraph">
<p>The interesting point about the code here is to clear the state of the
<em>to-be-parsed</em> message before each request-response pair. In the previous code,
this was done binding the “method token arrived” event — the first token in a
HTTP request — with such state cleanup.</p>
</div>
<div class="paragraph">
<p>By now, you&#8217;re ready to use this library in your projects. You may want to check
Boost.Http own usage of the parser or the Tufão library as real-world and
complete examples of this parser.</p>
</div>
<div class="ulist">
<div class="title">See also</div>
<ul>
<li>
<p><a href="#request_response_diff">What are the differences between <code>reader::request</code> and
<code>reader::response</code>?</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="parsing_tutorial2">2.2. Parsing (advanced)</h3>
<div class="paragraph">
<p>In this tutorial, you&#8217;ll learn how to use this library to parse HTTP streams
easily.</p>
</div>
<div class="paragraph">
<p>The architecture of the library is broken into two classes of parsers, the
content parsers and the structural parsers.</p>
</div>
<div class="paragraph">
<p>The content parsers handle non-structural elements, terminal tokens, all easy to
match and decode. They are stateless. They are mini-parsers for elements easy to
parse and by themselves don&#8217;t add much value to justify a library (don&#8217;t confuse
<em>low value</em> with <em>valueless</em>). They live in the <code>boost::http::syntax</code>
namespace. They are useful when you want to parse individual HTTP elements like
the <code>range</code> header value. We won&#8217;t see them in this tutorial.</p>
</div>
<div class="paragraph">
<p>The structural parsers handle structured data formats (e.g. HTTP). To achieve
flexibility and performance requirements, they follow the incremental/pull
parser model (a bit like the more traditional Iterator design pattern as
described in the Gang-of-Four book, instead of C++ iterators). These parsers
live in the <code>boost::http::reader</code> namespace. These are the parsers we will look
into now.</p>
</div>
<div class="paragraph">
<p>In the future, we may add support for HTTP/2.0 stream format, but for now, we
are left with two structural parsers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>boost::http::reader::request</code> for HTTP/1.0 and HTTP/1.1 request messages.</p>
</li>
<li>
<p><code>boost::http::reader::response</code> for HTTP/1.0 and HTTP/1.1 response messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each structural parser is prepared to receive a continuous stream of messages
(i.e. what NodeJS correctly refer to as keep-alive persistent streams). Because
the structure of messages is flexible enough to be non-representable in simple
non-allocating C++ structures, we don&#8217;t decode the whole stream as a single
parsing result as this would force allocation. What we do instead is to feed the
user with one token at a time and internally we keep a lightweight non-growing
state required to decode further tokens.</p>
</div>
<div class="paragraph">
<p>We use the same token definition for HTTP requests and HTTP responses. The
tokens can be either of status (e.g. <code>error</code> or <code>skip</code>), structural (e.g.
<code>boost::http::token::code::end_of_headers</code>) or data (e.g.
<code>boost::http::token::code::field_name</code>) categories. Only tokens of the data
category have an associated value.</p>
</div>
<div class="paragraph">
<p>Each token is associated with a slice (possibly 0-sized if <code>error</code> token or a
token from the structural category) of the byte stream. The process goes as
follow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the buffer used by the reader.</p>
</li>
<li>
<p>Consume tokens.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check <code>code()</code> return.</p>
</li>
<li>
<p>Possibly call <code>value&lt;T&gt;()</code> to extract token value.</p>
</li>
<li>
<p>Call <code>next()</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Remove parsed data from the buffer.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You&#8217;ll need to keep state of parsed vs unparsed data by calling
<code>token_size()</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the address of the unparsed data changes, the reader is invalidated, so to
speak. You can restore its valid state by setting the buffer to null or to
the new address of the unparsed data.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enough with abstract info. Take the following part of an HTTP stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET / HTTP/1.1\r\n
Host: www.example.com\r\n
\r\n</pre>
</div>
</div>
<div class="paragraph">
<p>This stream can be broken in the following series of tokens (order preserved):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>method</code>.</p>
</li>
<li>
<p><code>request_target</code>.</p>
</li>
<li>
<p><code>skip</code>.</p>
</li>
<li>
<p><code>version</code>.</p>
</li>
<li>
<p><code>field_name</code>.</p>
</li>
<li>
<p><code>field_value</code>.</p>
</li>
<li>
<p><code>skip</code>.</p>
</li>
<li>
<p><code>end_of_headers</code>.</p>
</li>
<li>
<p><code>end_of_body</code>.</p>
</li>
<li>
<p><code>end_of_message</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parser is required to give you a <code>token_size()</code> so you can remove parsed
data from the stream. However, the parser is not required to give the same
series of tokens for the same stream. The strucutral and data tokens will always
be emitted the same. However, the parser may choose to merge some status token
(e.g.  <code>skip</code>) with a data token (e.g. <code>request_target</code>). Therefore, the
following series of tokens would also be possible for the same example given
previously:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>method</code>.</p>
</li>
<li>
<p><code>skip</code>.</p>
</li>
<li>
<p><code>request_target</code>.</p>
</li>
<li>
<p><code>version</code>.</p>
</li>
<li>
<p><code>field_name</code>.</p>
</li>
<li>
<p><code>skip</code>.</p>
</li>
<li>
<p><code>field_value</code>.</p>
</li>
<li>
<p><code>end_of_headers</code>.</p>
</li>
<li>
<p><code>end_of_body</code>.</p>
</li>
<li>
<p><code>end_of_message</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This (non-)guarantee is to give freedom to vary the implementation. It&#8217;d be
absurd to expect different implementations of this interface generating the same
result byte by byte. You may expect different algorithms also in future
versions.</p>
</div>
<div class="paragraph">
<p>Another useful feature of this non-guarantee is to make possible to discard
<code>skip</code> tokens in the buffer, but merge them if the stream is received in the
buffer at once.</p>
</div>
<div class="paragraph">
<p>Just imagine documenting the guarantees of the token stream if we were to make
it predictable. It&#8217;d be insane.</p>
</div>
<div class="paragraph">
<p>However, there is one guarantee that the reader object must provide. It must not
discard bytes of data tokens while the token is incomplete. To illustrate this
point, let&#8217;s go to an example. Given the current token is <code>request_target</code>, you
have the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">assert</span><span class="tok-p">(</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-p">);</span>
<span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While we traverse the stream, the parser will only <em>match</em> tokens. We don&#8217;t
expect the parser to also <em>decode</em> the tokens. The parser will only decode the
tokens if necessary to further match the following tokens. And even when the
parser decod&#8217;em, the intermediary results may be discarded. In other words,
<em>match</em> and <em>decode</em> are separate steps and you can spare CPU time when you
don&#8217;t need to decode certain elements.</p>
</div>
<div class="paragraph">
<p>The point is that the token value must be extracted directly from the byte
stream and the parser is not allowed to buffer data about the stream (or the
decoded values, for that matter). The implication of this rule gives a guarantee
about the token order and its relationship to the bytem stream.</p>
</div>
<div class="paragraph">
<p>You can imagine the stream as having two views. The tokens and the byte
streams. The token view spans windows over the byte view.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tokens: | method | skip  | request_target | skip          | version
bytes:  |  GET   | &lt;SPC&gt; |     /          | &lt;SPC&gt; HTTP/1. | 1 &lt;CRLF&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The slice of data associated with a data token can grow larger than the
equivalent bytes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tokens: |  method    | request_target | skip  | version
bytes:  |  GET &lt;SPC&gt; |     /          | &lt;SPC&gt; | HTTP/1.1 &lt;CRLF&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>But it cannot shrink smaller than its associated bytes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tokens: | method | skip    | request_target | skip           | version
bytes:  |  GE    | T &lt;SPC&gt; |     /          | &lt;SPC&gt; HTTP/1.1 | &lt;CRLF&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>So you have a token interface easy to inspect and you have a lot of freedom to
manage the underlying buffer. Let&#8217;s see the <code>boost::http::reader::request</code>
parser as used in Tufão:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-n">HttpServerRequest</span><span class="tok-o">::</span><span class="tok-n">onReadyRead</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">timeout</span><span class="tok-p">)</span>
        <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">timer</span><span class="tok-p">.</span><span class="tok-n">start</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">timeout</span><span class="tok-p">);</span>

    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span> <span class="tok-o">+=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">readAll</span><span class="tok-p">();</span>
    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span>
                                         <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">()));</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">Signals</span> <span class="tok-n">whatEmit</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-kt">bool</span> <span class="tok-n">is_upgrade</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>

    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_set_method</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_use_another_connection</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_data</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_no_host</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_content_length</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_content_length_overflow</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_transfer_encoding</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_chunk_size_overflow</span><span class="tok-p">:</span>
            <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-n">close</span><span class="tok-p">();</span>
            <span class="tok-k">return</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-n">clearRequest</span><span class="tok-p">();</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">responseOptions</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">QByteArray</span> <span class="tok-nf">method</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">method</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">QByteArray</span> <span class="tok-nf">url</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">url</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">value</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">httpVersion</span> <span class="tok-o">=</span> <span class="tok-n">HttpVersion</span><span class="tok-o">::</span><span class="tok-n">HTTP_1_0</span><span class="tok-p">;</span>
                    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">responseOptions</span> <span class="tok-o">|=</span> <span class="tok-n">HttpServerResponse</span><span class="tok-o">::</span><span class="tok-n">HTTP_1_0</span><span class="tok-p">;</span>
                <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
                    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">httpVersion</span> <span class="tok-o">=</span> <span class="tok-n">HttpVersion</span><span class="tok-o">::</span><span class="tok-n">HTTP_1_1</span><span class="tok-p">;</span>
                    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">responseOptions</span> <span class="tok-o">|=</span> <span class="tok-n">HttpServerResponse</span><span class="tok-o">::</span><span class="tok-n">HTTP_1_1</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">status_code</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">reason_phrase</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">lastHeader</span> <span class="tok-o">=</span> <span class="tok-n">QByteArray</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">QByteArray</span> <span class="tok-nf">header</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">lastHeader</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">header</span><span class="tok-p">));</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">lastHeader</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_value</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">trailer_value</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">QByteArray</span> <span class="tok-nf">header</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">trailers</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">lastHeader</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">header</span><span class="tok-p">));</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">lastHeader</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_headers</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">it</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">find</span><span class="tok-p">(</span><span class="tok-s">&quot;connection&quot;</span><span class="tok-p">);</span>
                <span class="tok-kt">bool</span> <span class="tok-n">close_found</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
                <span class="tok-kt">bool</span> <span class="tok-n">keep_alive_found</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
                <span class="tok-k">for</span> <span class="tok-p">(;</span><span class="tok-n">it</span> <span class="tok-o">!=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">();</span><span class="tok-o">++</span><span class="tok-n">it</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span><span class="tok-p">(</span><span class="tok-n">it</span><span class="tok-o">-&gt;</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">it</span><span class="tok-o">-&gt;</span><span class="tok-n">size</span><span class="tok-p">());</span>
                    <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">header_value_any_of</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-o">&amp;</span><span class="tok-p">](</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;close&quot;</span><span class="tok-p">))</span>
                            <span class="tok-n">close_found</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>

                        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;keep-alive&quot;</span><span class="tok-p">))</span>
                            <span class="tok-n">keep_alive_found</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>

                        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;upgrade&quot;</span><span class="tok-p">))</span>
                            <span class="tok-n">is_upgrade</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>

                        <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
                    <span class="tok-p">});</span>
                    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">close_found</span><span class="tok-p">)</span>
                        <span class="tok-k">break</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">close_found</span>
                    <span class="tok-o">&amp;&amp;</span> <span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">httpVersion</span> <span class="tok-o">==</span> <span class="tok-n">HttpVersion</span><span class="tok-o">::</span><span class="tok-n">HTTP_1_1</span>
                        <span class="tok-o">||</span> <span class="tok-n">keep_alive_found</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">responseOptions</span> <span class="tok-o">|=</span> <span class="tok-n">HttpServerResponse</span><span class="tok-o">::</span><span class="tok-n">KEEP_ALIVE</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>
                <span class="tok-n">whatEmit</span> <span class="tok-o">=</span> <span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">READY</span><span class="tok-p">;</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">body_chunk</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">body_chunk</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer_cast</span><span class="tok-o">&lt;</span><span class="tok-k">const</span> <span class="tok-kt">char</span><span class="tok-o">*&gt;</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span>
                                  <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer_size</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">));</span>
                <span class="tok-n">whatEmit</span> <span class="tok-o">|=</span> <span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">DATA</span><span class="tok-p">;</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_body</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_message</span><span class="tok-p">:</span>
            <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-n">nparsed</span><span class="tok-p">,</span>
                                                 <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">()));</span>
            <span class="tok-n">whatEmit</span> <span class="tok-o">|=</span> <span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">END</span><span class="tok-p">;</span>
            <span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">,</span> <span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">readyRead</span><span class="tok-p">()),</span>
                       <span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-n">SLOT</span><span class="tok-p">(</span><span class="tok-n">onReadyRead</span><span class="tok-p">()));</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">is_upgrade</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">,</span> <span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">readyRead</span><span class="tok-p">()),</span>
                   <span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-n">SLOT</span><span class="tok-p">(</span><span class="tok-n">onReadyRead</span><span class="tok-p">()));</span>
        <span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">socket</span><span class="tok-p">,</span> <span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">disconnected</span><span class="tok-p">()),</span>
                   <span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">close</span><span class="tok-p">()));</span>
        <span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">timer</span><span class="tok-p">,</span> <span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">timeout</span><span class="tok-p">()),</span> <span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-n">SLOT</span><span class="tok-p">(</span><span class="tok-n">onTimeout</span><span class="tok-p">()));</span>

        <span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">body</span><span class="tok-p">.</span><span class="tok-n">swap</span><span class="tok-p">(</span><span class="tok-n">priv</span><span class="tok-o">-&gt;</span><span class="tok-n">buffer</span><span class="tok-p">);</span>
        <span class="tok-n">emit</span> <span class="tok-nf">upgrade</span><span class="tok-p">();</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">whatEmit</span><span class="tok-p">.</span><span class="tok-n">testFlag</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">READY</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">whatEmit</span> <span class="tok-o">&amp;=</span> <span class="tok-o">~</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">Signals</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">READY</span><span class="tok-p">);</span>
        <span class="tok-k">this</span><span class="tok-o">-&gt;</span><span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">()));</span>
        <span class="tok-k">this</span><span class="tok-o">-&gt;</span><span class="tok-n">disconnect</span><span class="tok-p">(</span><span class="tok-n">SIGNAL</span><span class="tok-p">(</span><span class="tok-n">end</span><span class="tok-p">()));</span>
        <span class="tok-n">emit</span> <span class="tok-nf">ready</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">whatEmit</span><span class="tok-p">.</span><span class="tok-n">testFlag</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">DATA</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">whatEmit</span> <span class="tok-o">&amp;=</span> <span class="tok-o">~</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">Signals</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">DATA</span><span class="tok-p">);</span>
        <span class="tok-n">emit</span> <span class="tok-nf">data</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">whatEmit</span><span class="tok-p">.</span><span class="tok-n">testFlag</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">END</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">whatEmit</span> <span class="tok-o">&amp;=</span> <span class="tok-o">~</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">Signals</span><span class="tok-p">(</span><span class="tok-n">Priv</span><span class="tok-o">::</span><span class="tok-n">END</span><span class="tok-p">);</span>
        <span class="tok-n">emit</span> <span class="tok-nf">end</span><span class="tok-p">();</span>
        <span class="tok-k">return</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Boost.Http higher level message framework&#8217;s socket has a buffer of fixed size
and cannot have the luxury of appending data every time. Both high level
projects have many fundamental differences.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Boost.Http</th>
<th class="tableblock halign-left valign-top">Tufão</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boost.Asio active style.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Qt event loop passive style.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boost usage allowed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It uses this header-only parser lib at Tufão build time and Tufão user will
 never need Boost again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-based framework which allows different backends to be plugged later
 keeping the same handlers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tied to HTTP/1.1 embedded server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Callbacks and completion tokens. It may read more than asked for, but it&#8217;ll use
 <code>read_state</code> to keep user informed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combined with Qt network reactive programming style, it has a strange logic
 related to event signalling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proper HTTP upgrade semantics.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strange HTTP upgrade semantics thanks to the immaturity of following NodeJS
 design decisions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">It normalizes all header keys to lower case.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case insensitive string classes for the C++ counterpart of the HTTP field names
 structure.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These are the main differences that I wanted to note. You can be sure this
parser will fit you and it&#8217;ll be easy to use. And more importantly, easy to use
<strong>right</strong>.
<a href="https://vinipsmaker.wordpress.com/2016/08/05/boost-http-has-a-new-parser/">NodeJS
parser demands too much HTTP knowledge on the user behalf</a>. And thanks to the
NodeJS parser hard to use API, Tufão only was able to support proper HTTP
pipelining once it migrated to Boost.Http parser (although Boost.Http managed to
do lots of ninja techs to support it under NodeJS parser).</p>
</div>
<div class="paragraph">
<p>To sum up the data received handler structure, you need:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the buffer right with <code>parser.set_buffer(buf)</code>.</p>
</li>
<li>
<p>Loop to consume — <code>parser.next()</code> — tokens while
<code>http::token::code::error_insufficient_data</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Examine token with <code>parser.code()</code>.</p>
</li>
<li>
<p>Maybe handle error.</p>
</li>
<li>
<p>Extract data with <code>parser.value&lt;T&gt;()</code> if a data token.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Remove parsed data.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are a lot of different HTTP server/client models you can build on top of
this framework and the notification style you&#8217;re to use is entirely up
to you. Most likely, you&#8217;ll want to hook some actions when the
always-to-be-triggered delimiters category tokens (e.g.
<code>boost::http::token::code::end_of_headers</code>) are reached.</p>
</div>
</div>
<div class="sect2">
<h3 id="parsing_tutorial3">2.3. Parsing HTTP upgrade</h3>
<div class="paragraph">
<p>Given you already know the basics, parsing HTTP upgrade is trivial. Because the
HTTP parser doesn&#8217;t take ownership of the buffer and you pretty much know up
until which point the stream was parsed as HTTP.</p>
</div>
<div class="paragraph">
<p>All you gotta do is consume all the HTTP data (i.e. watch for
<code>code::end_of_message</code>) and parse the rest of the buffer as the new
protocol. Here is the Tufão code to update an HTTP client to WebSocket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kr">inline</span> <span class="tok-kt">bool</span> <span class="tok-n">WebSocketHttpClient</span><span class="tok-o">::</span><span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-n">QByteArray</span> <span class="tok-o">&amp;</span><span class="tok-n">chunk</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">errored</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>

    <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">chunk</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">chunk</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">()));</span>

    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">switch</span><span class="tok-p">(</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_set_method</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable: we did call `set_method`&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_use_another_connection</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_data</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_no_host</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_content_length</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_content_length_overflow</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_invalid_transfer_encoding</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">error_chunk_size_overflow</span><span class="tok-p">:</span>
            <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
            <span class="tok-n">qFatal</span><span class="tok-p">(</span><span class="tok-s">&quot;unreachable&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
                <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
            <span class="tok-p">}</span>

            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">status_code</span><span class="tok-p">:</span>
            <span class="tok-n">status_code</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">status_code</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">status_code</span> <span class="tok-o">!=</span> <span class="tok-mi">101</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-n">errored</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
                <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
            <span class="tok-p">}</span>

            <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">set_method</span><span class="tok-p">(</span><span class="tok-s">&quot;GET&quot;</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">reason_phrase</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">lastHeader</span> <span class="tok-o">=</span> <span class="tok-n">QByteArray</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
            <span class="tok-p">{</span>
                <span class="tok-k">auto</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
                <span class="tok-n">QByteArray</span> <span class="tok-nf">header</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
                <span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">lastHeader</span><span class="tok-p">,</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">move</span><span class="tok-p">(</span><span class="tok-n">header</span><span class="tok-p">));</span>
                <span class="tok-n">lastHeader</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span>
            <span class="tok-p">}</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_headers</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">body_chunk</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_body</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_name</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">trailer_value</span><span class="tok-p">:</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-k">case</span> <span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_message</span><span class="tok-p">:</span>
            <span class="tok-n">ready</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
            <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">chunk</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-n">nparsed</span><span class="tok-p">,</span>
                                           <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">()));</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
        <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
    <span class="tok-n">nparsed</span> <span class="tok-o">+=</span> <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
    <span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">chunk</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">ready</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">headers</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Upgrade&quot;</span><span class="tok-p">))</span>
        <span class="tok-k">return</span> <span class="tok-nb">true</span><span class="tok-p">;</span>

    <span class="tok-k">return</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_boost_beast_parser_interface">2.4. Implementing Boost.Beast parser interface</h3>
<div class="paragraph">
<p>In this tutorial, we&#8217;ll show you how to implement Boost.Beast parser interface
using Boost.Http parser.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
No prior experience with Boost.Beast is required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Boost.Beast parser borrows much of its design from Ryan Dahl&#8217;s HTTP parser — the
NodeJS parser. This is a design that I do know and used more than once in
different projects. However, this is not the only design I know of. I see much
of this design as an evolution of the language limitations that you find in the
C language.</p>
</div>
<div class="paragraph">
<p><a href="https://vinipsmaker.wordpress.com/2016/08/05/boost-http-has-a-new-parser/">I&#8217;ve
previously written a few complaints about the Ryan Dahl&#8217;s HTTP
parser</a>. Boost.Beast evolves from this design and takes a few different
decisions. We&#8217;ll see if, and which, limitations the Boost.Beast parser still
carries thanks to this inheritance.</p>
</div>
<div class="sect3">
<h4 id="_learning_how_to_use_the_parser">2.4.1. Learning how to use the parser</h4>
<div class="paragraph">
<p>The parser is represented by a <code>basic_parser&lt;isRequest, Derived&gt;</code> class. The
parser is callback-based just like Ryan Dahl&#8217;s HTTP parser and it uses CRTP to
avoid the overhead of virtual function calls.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>And here we can notice the first difference between Boost.Beast and Boost.Http
parsers.</p>
</div>
<div class="paragraph">
<p>If you design an algorithm to work on the parser object, this algorithm must be
a template (and it carries the same drawbacks of a header-only library):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Derived</span><span class="tok-o">&gt;</span>
<span class="tok-kt">void</span> <span class="tok-n">do_stuff</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">beast</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">basic_parser</span><span class="tok-o">&lt;</span><span class="tok-nb">true</span><span class="tok-p">,</span> <span class="tok-n">Derived</span><span class="tok-o">&gt;</span> <span class="tok-n">o</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But if you use Boost.Http parser, this requirement vanishes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-nf">do_stuff</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">reader</span><span class="tok-o">::</span><span class="tok-n">request</span> <span class="tok-n">o</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To feed the parser with data, you call <code>basic_parser::put</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span>
    <span class="tok-k">class</span> <span class="tok-nc">ConstBufferSequence</span><span class="tok-o">&gt;</span>
<span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span>
<span class="tok-n">put</span><span class="tok-p">(</span>
    <span class="tok-n">ConstBufferSequence</span> <span class="tok-k">const</span><span class="tok-o">&amp;</span> <span class="tok-n">buffers</span><span class="tok-p">,</span>
    <span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The parser will match <strong>and</strong> decode the tokens in the stream.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>Match and decoding are always applied together. What does this mean? Not much,
given decoding HTTP/1.1 tokens is cheap and most of the time it reduces to
return a <code>string_view</code> of the associated buffer region.</p>
</div>
<div class="paragraph">
<p>However, the implications of the fundamental model chosen (pull or push) give
rise to larger divergences at this point already.</p>
</div>
<div class="paragraph">
<p>In the Boost.Beast parser, the token is passed to the function callback
registered. In the Boost.Http parser, the token is hold by the parser object
itself.</p>
</div>
<div class="paragraph">
<p>It might not seem much difference at the first glance, but consider the problem
of composability. If I want to write an algorithm to take a
<code>boost::http::reader::request</code> object to read a <code>field_name</code> token and possibly
skip it together with the associated <code>field_value</code> (maybe that field isn&#8217;t of
your interest), you only need to wrap the parser object if you&#8217;re using the
Boost.Http solution <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>. As for the Boost.Beast parser, you&#8217;re left with a long and hackishy
inheritance chain that I don&#8217;t even want to imagine right now if you were to
compose the algorithms.</p>
</div>
<div class="paragraph">
<p>Just as a concrete illustration of what I meant by the Boost.Http solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">T</span> <span class="tok-cm">/* = http::reader::request */</span><span class="tok-o">&gt;</span>
<span class="tok-kt">void</span> <span class="tok-n">socket_consumer</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;::</span><span class="tok-n">parse</span><span class="tok-p">(</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span> <span class="tok-n">buf</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-cm">/* ... */</span> <span class="tok-p">}</span>

<span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">my_parser_wrapper</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-k">const</span>
<span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-n">code_</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-n">my_parser_wrapper</span><span class="tok-o">::</span><span class="tok-n">next</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-c1">// Here I should use a case-insensitive comparison function.</span>
    <span class="tok-c1">// For simplicity, this step is omitted.</span>

    <span class="tok-n">wrapped_parser</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
    <span class="tok-n">code_</span> <span class="tok-o">=</span> <span class="tok-n">wrapped_parser</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">();</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">code_</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">field_name</span>
        <span class="tok-o">&amp;&amp;</span> <span class="tok-p">(</span><span class="tok-n">wrapped_parser</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">()</span>
            <span class="tok-o">==</span> <span class="tok-s">&quot;connection&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">code_</span> <span class="tok-o">=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">skip</span><span class="tok-p">;</span>
        <span class="tok-n">skip_next_value</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">code_</span> <span class="tok-o">==</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">field_value</span>
               <span class="tok-o">&amp;&amp;</span> <span class="tok-n">skip_next_value</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-n">code_</span> <span class="tok-o">=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">skip</span><span class="tok-p">;</span>
        <span class="tok-n">skip_next_value</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How would the solution look like using the Boost.Beast parser? Let&#8217;s draft
something:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Derived</span><span class="tok-o">&gt;</span>
<span class="tok-k">class</span> <span class="tok-nc">my_parser_wrapper</span>
    <span class="tok-o">:</span> <span class="tok-k">public</span> <span class="tok-n">basic_parser</span><span class="tok-o">&lt;</span><span class="tok-nb">true</span><span class="tok-p">,</span> <span class="tok-n">my_parser_wrapper</span><span class="tok-o">&lt;</span><span class="tok-n">Derived</span><span class="tok-o">&gt;&gt;</span>
<span class="tok-p">{</span>
<span class="tok-k">public</span><span class="tok-o">:</span>
    <span class="tok-kt">void</span>
    <span class="tok-n">on_field_impl</span><span class="tok-p">(</span><span class="tok-n">field</span> <span class="tok-n">f</span><span class="tok-p">,</span> <span class="tok-n">string_view</span> <span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-n">string_view</span> <span class="tok-n">value</span><span class="tok-p">,</span> <span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-c1">// Here I should use a case-insensitive comparison function.</span>
        <span class="tok-c1">// For simplicity, this step is omitted.</span>

        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">name</span> <span class="tok-o">==</span> <span class="tok-s">&quot;connection&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-k">static_cast</span><span class="tok-o">&lt;</span><span class="tok-n">Derived</span><span class="tok-o">&amp;&gt;</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-n">on_field_impl</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">,</span> <span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">,</span> <span class="tok-n">ec</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>

    <span class="tok-kt">void</span> <span class="tok-n">on_header_impl</span><span class="tok-p">(</span><span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">static_cast</span><span class="tok-o">&lt;</span><span class="tok-n">Derived</span><span class="tok-o">&amp;&gt;</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-n">on_header_impl</span><span class="tok-p">(</span><span class="tok-n">ec</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>

    <span class="tok-c1">// ...</span>
<span class="tok-p">};</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">template</span> <span class="tok-o">&lt;</span><span class="tok-k">typename</span><span class="tok-o">&gt;</span> <span class="tok-k">class</span> <span class="tok-nc">parser</span><span class="tok-o">&gt;</span>
<span class="tok-k">class</span> <span class="tok-nc">custom_parser</span>
    <span class="tok-o">:</span> <span class="tok-k">public</span> <span class="tok-n">parser</span><span class="tok-o">&lt;</span><span class="tok-n">custom_parser</span><span class="tok-o">&gt;</span>
<span class="tok-p">{</span>
    <span class="tok-c1">// Here we have our original handler.</span>
    <span class="tok-c1">// It&#39;d be our `my_socket_consumer` from the Boost.Http example.</span>
<span class="tok-p">};</span>

<span class="tok-n">custom_parser</span><span class="tok-o">&lt;</span><span class="tok-n">my_parser_wrapper</span><span class="tok-o">&gt;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this solution is fully flawed. As <code>my_parser_wrapper</code> inherits directly
from <code>basic_parser</code>, we cannot inject some <code>my_parser_wrapper2</code> which applies
another transformation in the chain.</p>
</div>
<div class="paragraph">
<p>I can&#8217;t emphasize enough that the problem is <strong>not</strong> about adding a
“skip-this-set-of-HTTP-headers” function. The problem is about a fundamental
building block which can solve more of the user needs. I could keep thinking
about the different problems that could happen, but if you do not give a <strong>try</strong>
to enter in the <em>general</em> problem and insist on a <em>myopic vision</em>, you&#8217;ll
<strong>never</strong> grasp my message (just as an addicted to inductive reasoning will never
understand someone who is using deductive reasoning). If all you have is a
hammer, everything looks like a nail. We shall see more design implications
later on as we continue this chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As the tokens are found, the user callbacks are called. The function returns the
number of parsed bytes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>And as each sentence goes on, it seems that I need to explain more design
implications.</p>
</div>
<div class="paragraph">
<p>What if you want to <em>reject</em> messages as soon as one specific token is found?
The point here is about avoiding unnecessary computation of parsing elements of
a message that would be rejected anyway.</p>
</div>
<div class="paragraph">
<p>For Boost.Http parser, the control flow is yours to take and&#8230;&#8203;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Do what thou wilt</strong> shall be the whole of the Law.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Aleister Crowley
</div>
</div>
<div class="paragraph">
<p>A concrete example if you may:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-c1">// ...</span>

<span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">last_header_was_x</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">is_good</span><span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">()))</span> <span class="tok-p">{</span>
        <span class="tok-c1">// stop the world (e.g. `return` or `throw`)</span>
    <span class="tok-p">}</span>

<span class="tok-c1">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As for Boost.Beast parser. There <strong>is</strong> an answer, but not with your current
limited knowledge of the API. Let&#8217;s continue to present Boost.Beast API and come
back at this “stop the world” problem later.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The behaviour usually found in push parsers is to parse the stream until the end
of the feeded buffers and then return. This is the NodeJS&#8217;s parser approach from
which Boost.Beast takes much inspiration. However, Boost.Beast takes a slightly
different approach to this problem so it&#8217;s possible to parse only one token at a
time. The Boost.Beast solution is the <code>eager</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span>
<span class="tok-nf">eager</span><span class="tok-p">(</span>
    <span class="tok-kt">bool</span> <span class="tok-n">v</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Normally the parser returns after successfully parsing a structured element
(header, chunk header, or chunk body) even if there are octets remaining in the
input. This is necessary when attempting to parse the header first, or when the
caller wants to inspect information which may be invalidated by subsequent
parsing, such as a chunk extension. The eager option controls whether the parser
keeps going after parsing structured element if there are octets remaining in
the buffer and no error occurs. This option is automatically set or cleared
during certain stream operations to improve performance with no change in
functionality.</p>
</div>
<div class="paragraph">
<p>The default setting is <code>false</code>.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Vinnie Falco<br>
<cite>Boost.Beast documentation</cite>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>And now, back at the “stop the world” problem&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Simply put, Boost.Beast solution is just a hackishy way to implement a pull
parser — the parser approach <em>consciously</em> chosen by Boost.Http parser.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can just set the <code>error_code&amp; ec</code> on the callback
implementation to stop parsing, but this wouldn&#8217;t solve all the use cases (the
reason why <code>eager</code> is provided).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Continuing this inductive reasoning of “hey! a problem appeared, let&#8217;s write yet
another function, <code>function_xyz</code>, to solve use case 777”, a number of other
functions are provided. One of them is <code>header_limit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span>
<span class="tok-nf">header_limit</span><span class="tok-p">(</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">uint32_t</span> <span class="tok-n">v</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This function sets the maximum allowed size of the header including all field
name, value, and delimiter characters and also including the CRLF sequences in
the serialized input. If the end of the header is not found within the limit of
the header size, the error <code>http::header_limit</code> is returned by
<code>http::basic_parser::put</code>.</p>
</div>
<div class="paragraph">
<p>Setting the limit after any header octets have been parsed results in undefined
behavior.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Vinnie Falco<br>
<cite>Boost.Beast documentation</cite>
</div>
</div>
<div class="paragraph">
<p>Another function, <code>body_limit</code>, is provided in the same spirit of
<code>header_limit</code>. What if I have a use case to limit <code>request-target</code> size? Then
Boost.Beast author will add <code>function_xyz2</code> to use case 778.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>What is the Boost.Http solution to this problem 🤔? This is broken into two
possible cases.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The whole token is in the buffer: In such case you just need to check
<code>token_size</code>.</p>
</li>
<li>
<p>The buffer has been exhausted and no token is there: Here, just check
<code>expected_token</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It&#8217;ll work for <strong>any</strong> token (i.e. you don&#8217;t need one extra function for each
possible token which would just complicate the implementation and inflate the
object with a large <code>Settings</code> object of some sort).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With all this info, the Boost.Beast parser is mostly covered and we can delve
into the implementation of such interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">DESIGN IMPLICATIONS</div>
<div class="paragraph">
<p>Now&#8230;&#8203; let&#8217;s look at something different. Suppose the following scenario:</p>
</div>
<div class="paragraph">
<p>You have an embedded project and the headers must not be stored (as it&#8217;d imply
heap memory of complex data structures). You process options with an in situ
algorithm out from the headers. In Boost.Http parser, I&#8217;m imagining something in
these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">enum</span> <span class="tok-n">last_header_code</span> <span class="tok-p">{</span>
    <span class="tok-n">OUT_OF_INTEREST_SET</span><span class="tok-p">,</span>
    <span class="tok-n">FOO</span><span class="tok-p">,</span>
    <span class="tok-n">BAR</span><span class="tok-p">,</span>
    <span class="tok-n">FOOBAR</span>
<span class="tok-p">};</span>

<span class="tok-c1">// ...</span>

<span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_name</span><span class="tok-p">:</span>
    <span class="tok-p">{</span>
        <span class="tok-k">auto</span> <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-o">&gt;</span><span class="tok-p">();</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">FOO</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">BAR</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">,</span> <span class="tok-s">&quot;foobar&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">FOOBAR</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
            <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">OUT_OF_INTEREST_SET</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
        <span class="tok-k">break</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
<span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">field_value</span><span class="tok-p">:</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">last_header</span> <span class="tok-o">==</span> <span class="tok-n">FOO</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-n">process_foo</span><span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">last_header</span> <span class="tok-o">==</span> <span class="tok-n">BAR</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-n">process_bar</span><span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">last_header</span> <span class="tok-o">==</span> <span class="tok-n">FOOBAR</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-n">foobar</span> <span class="tok-o">=</span> <span class="tok-n">process_foobar</span><span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-o">&gt;</span><span class="tok-p">());</span>
    <span class="tok-p">}</span>
    <span class="tok-k">break</span><span class="tok-p">;</span>

<span class="tok-c1">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Boost.Beast solution is not hard to imagine too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-c1">// ...</span>

<span class="tok-kt">void</span> <span class="tok-nf">on_field_impl</span><span class="tok-p">(</span><span class="tok-n">field</span><span class="tok-p">,</span> <span class="tok-n">string_view</span> <span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-n">string_view</span> <span class="tok-n">value</span><span class="tok-p">,</span> <span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-n">process_foo</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">);</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-n">process_bar</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">);</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">iequals</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-s">&quot;foobar&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-n">foobar</span> <span class="tok-o">=</span> <span class="tok-n">process_foobar</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-c1">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So&#8230;&#8203; what does each design <em>implies</em>? As Boost.Beast parser always parse field
name + field value <em>together</em>, if both fields sum up more than the buffer size,
you&#8217;re out of luck. Both tokens must fit in the buffer together.</p>
</div>
<div class="paragraph">
<p>Just as an exercise, let&#8217;s pursue the inductive reasoning applied to this
problem. We <em>could</em> split the Boost.Beast&#8217;s <code>on_field_impl</code> callback into two:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>void
on_field_name_impl(
    field f,
    string_view name,
    error_code&amp; ec);

void
on_field_value_impl(
    string_view value,
    error_code&amp; ec);</code></pre>
</div>
</div>
<div class="paragraph">
<p>But then we create another problem:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[&#8230;&#8203;] it is the responsibility of the derived class to copy any information it
needs before returning from the callback [&#8230;&#8203;]</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Vinnie Falco<br>
<cite>Boost.Beast documentation</cite>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t see a problem already, let me unveil it for you. Now, most of the
uses of the parser, which want to store the HTTP headers in some sort of
<code>std::multimap</code> structure will have to perform one extra allocation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">void</span> <span class="tok-nf">on_field_name_impl</span><span class="tok-p">(</span><span class="tok-n">field</span><span class="tok-p">,</span> <span class="tok-n">string_view</span> <span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">last_header</span> <span class="tok-o">=</span> <span class="tok-n">to_string</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Under the push parser model, these two cases are irreconcilable. Boost.Beast
opts to solve the most common problem and this was a good design choice (let&#8217;s
give credit where credit is due).</p>
</div>
<div class="paragraph">
<p>However, Boost.Http parser is a good choice in <em>any</em> of these two cases. It only
feeds one token at a time. And as Boost.Http message framework demonstrate,
<a href="https://github.com/BoostGSoC14/boost.http/blob/c7b3e11884420b55568222d237e9c429ec24b811/include/boost/http/socket-inl.hpp#L630">we
can use the first bytes of the buffer to store the HTTP field name</a>.</p>
</div>
<div class="paragraph">
<p>And just to present a more readable alternative, you could play with copies of
the reader object made in the stack of the
<code>my_socket_consumer::on_socket_callback</code> function. This way, you have a point in
time and you can make the parser “go back”. The copies are cheap because the
reader object is just an integer-based state machine with a few indexes. The
<em>idea</em> behind this solution is to mirror current Boost.Beast behaviour — field
name and field value are always kept together in the buffer.</p>
</div>
<div class="paragraph">
<p><strong>Remember</strong>&#8230;&#8203; principles. I can attack other specific cases. As an exercise, try
to find a few yourself.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_the_boost_beast_interface">2.4.2. Implementing the Boost.Beast interface</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>As we previously seen, there are several functions in Boost.Beast parser that
are just boilerplate inherited (e.g. <code>eager</code>) thanks to the choice of the wrong
fundamental model (i.e. pull vs push).</p>
</div>
<div class="paragraph">
<p>We&#8217;ll skip some of this boilerplate as it is not of our interest. Our purpose
with this tutorial was to show design implications derived from the choices of
the <em>fundamental</em> models.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span> <span class="tok-n">isRequest</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Derived</span><span class="tok-o">&gt;</span>
<span class="tok-k">class</span> <span class="tok-nc">basic_parser</span><span class="tok-p">;</span>

<span class="tok-c1">// This template specialization is wrong, but is kept for simplification</span>
<span class="tok-c1">// purposes.</span>
<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span> <span class="tok-n">isRequest</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Derived</span><span class="tok-o">&gt;</span>
<span class="tok-k">class</span> <span class="tok-nc">basic_parser</span><span class="tok-o">&lt;</span><span class="tok-nb">true</span><span class="tok-p">,</span> <span class="tok-n">Derived</span><span class="tok-o">&gt;</span>
<span class="tok-p">{</span>
<span class="tok-k">public</span><span class="tok-o">:</span>
    <span class="tok-k">template</span><span class="tok-o">&lt;</span>
        <span class="tok-k">class</span> <span class="tok-nc">ConstBufferSequence</span><span class="tok-o">&gt;</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span>
    <span class="tok-n">put</span><span class="tok-p">(</span>
        <span class="tok-n">ConstBufferSequence</span> <span class="tok-k">const</span><span class="tok-o">&amp;</span> <span class="tok-n">buffers</span><span class="tok-p">,</span>
        <span class="tok-n">error_code</span><span class="tok-o">&amp;</span> <span class="tok-n">ec</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-c1">// WARNING: the real implementation will have more trouble because of</span>
        <span class="tok-c1">// the `ConstBufferSequence` concept, but for the reason of simplicity,</span>
        <span class="tok-c1">// we don&#39;t show the real code here.</span>
        <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffers</span><span class="tok-p">);</span>

        <span class="tok-n">error_code</span> <span class="tok-n">ec</span><span class="tok-p">;</span>

        <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">()</span> <span class="tok-o">!=</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">error_insufficient_data</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">code</span><span class="tok-p">())</span> <span class="tok-p">{</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">skip</span><span class="tok-p">:</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">method</span><span class="tok-p">:</span>
                <span class="tok-n">method</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">request_target</span><span class="tok-p">:</span>
                <span class="tok-n">target</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">version</span><span class="tok-p">:</span>
                <span class="tok-k">static_cast</span><span class="tok-o">&lt;</span><span class="tok-n">Derived</span><span class="tok-o">&amp;&gt;</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-k">this</span><span class="tok-p">)</span>
                    <span class="tok-p">.</span><span class="tok-n">on_request_impl</span><span class="tok-p">(</span><span class="tok-cm">/*the enum code*/</span><span class="tok-p">,</span> <span class="tok-n">method</span><span class="tok-p">,</span> <span class="tok-n">target</span><span class="tok-p">,</span>
                                     <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-o">&lt;</span><span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-o">&gt;</span><span class="tok-p">(),</span> <span class="tok-n">ec</span><span class="tok-p">);</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">ec</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-c1">// TODO: extra code to enter in error state</span>
                    <span class="tok-k">return</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">parsed_count</span><span class="tok-p">();</span>
                <span class="tok-p">}</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>

            <span class="tok-c1">// ...</span>

            <span class="tok-k">case</span> <span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-nl">end_of_headers</span><span class="tok-p">:</span>
                <span class="tok-k">static_cast</span><span class="tok-o">&lt;</span><span class="tok-n">Derived</span><span class="tok-o">&amp;&gt;</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-n">on_header_impl</span><span class="tok-p">(</span><span class="tok-n">ec</span><span class="tok-p">);</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">ec</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-c1">// TODO: extra code to enter in error state</span>
                    <span class="tok-k">return</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">parsed_count</span><span class="tok-p">();</span>
                <span class="tok-p">}</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>

            <span class="tok-c1">// ...</span>
            <span class="tok-p">}</span>
            <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>

        <span class="tok-k">return</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">parsed_count</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>

<span class="tok-k">private</span><span class="tok-o">:</span>
    <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">http</span><span class="tok-o">::</span><span class="tok-n">reader</span><span class="tok-o">::</span><span class="tok-n">request</span> <span class="tok-n">reader</span><span class="tok-p">;</span>

    <span class="tok-c1">// It&#39;s possible and easy to create an implementation that doesn&#39;t allocate</span>
    <span class="tok-c1">// memory. Just keep a copy of `reader` within the `put` function body and</span>
    <span class="tok-c1">// you can go back. As `reader` is just an integer-based state machine with</span>
    <span class="tok-c1">// a few indexes, the copy is cheap. I&#39;m sorry I don&#39;t have the time to code</span>
    <span class="tok-c1">// the demonstration right now.</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">method</span><span class="tok-p">;</span>
    <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span> <span class="tok-n">target</span><span class="tok-p">;</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A final note I want to add is that I plan more improvements to the parser. Just
as Boost.Beast parser is an evolution of the wrong model chosen for the problem,
my parser still has room to <em>evolve</em>. But from my judgment, this parser already
is better than Boost.Beast parser can ever be (i.e. the problems I presented
here are unfixable in Boost.Beast design&#8230;&#8203; not to mention that Boost.Beast
parser has almost the double amount of member-functions to solve <em>the same</em>
problem <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="design_choices">3. Design choices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_faq">3.1. FAQ</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>How robust is this parser?</em></p>
<p>It doesn&#8217;t try to parse URLs at all. It&#8217;ll ensure that only valid characters
(according to HTTP request target BNF rule) are present, but invalid sequences
are accepted.</p>
<div class="paragraph">
<p>This parser is a little (but not too much) more liberal in what accepts and
it&#8217;ll accept invalid sequences for rarely used elements that don&#8217;t impact upper
layers of the application. The reason to accept such non-conformant sequences is
a simpler algorithm that can be more performant (e.g. we only check for invalid
chars, but not invalid sequences). Therefore, it&#8217;s advised to reframe the
message if you intend to forward it to some other participant. Not doing so,
might be a security issue if the participant you are forwarding your message to
is know to show improper behaviour when parsing invalid streams. There are
several references within the RFC7230 where similar decisions are suggested
(e.g. if you receive redundant Content-Length header field, you must merge it
into one before forwarding or reject the message as a whole).</p>
</div>
</li>
<li>
<p><em>Why not make a parser using Boost.Spirit?</em></p>
<p>Boost.Spirit needs backtracking to implement the OR operator. Boost.Spirit
can&#8217;t build a state machine which would allow you to continue parsing from the
suspended point/byte. Thanks to these characteristics, it can&#8217;t be used in our
HTTP parser. Also, we don&#8217;t see much benefit in pursuing this effort.</p>
</li>
<li>
<p><em>What is the recommended buffer size?</em></p>
<p>A buffer of size 7990 is recommended (suggested request line of 8000 by
section 3.1.1 of RFC7230 minus spaces, minus http version information minus
the minimum size of the other token in the request line). However, the real
suggested buffer size should be how long names you expect to have on your own
servers.</p>
</li>
<li>
<p><em>What are the differences between <code>reader::request</code> and <code>reader::response</code>?</em></p>
<div id="request_response_diff" class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>response</code> has the <code>void set_method(view_type method)</code> member-function.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This member-function <strong>MUST</strong> be called for each HTTP response message
being parsed in the stream.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>response</code> has the <code>void puteof()</code> member-function.</p>
</li>
<li>
<p><code>code()</code> member function return value has different guarantees in each class.</p>
</li>
<li>
<p><code>template&lt;class T&gt; typename T::type value() const</code> member function accepts
different input template arguments in each class.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_roadmap">3.2. Roadmap</h3>
<div class="ulist">
<ul>
<li>
<p>Parsers combinators.</p>
</li>
<li>
<p>Incremental message generator.</p>
</li>
<li>
<p>Iterator adaptors.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference">4. Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All declarations from this library resides within the <code>boost::http</code>
namespace. For brevity, this prefix is <strong>not</strong> repeated on the documentation.</p>
</div>
<div class="sect2">
<h3 id="_summary">4.1. Summary</h3>
<div class="sect3">
<h4 id="_classes">4.1.1. Classes</h4>
<div class="ulist">
<ul>
<li>
<p>Tokens</p>
<div class="ulist">
<ul>
<li>
<p><a href="#token_skip"><code>token::skip</code></a></p>
</li>
<li>
<p><a href="#token_field_name"><code>token::field_name</code></a></p>
</li>
<li>
<p><a href="#token_field_value"><code>token::field_value</code></a></p>
</li>
<li>
<p><a href="#token_body_chunk"><code>token::body_chunk</code></a></p>
</li>
<li>
<p><a href="#token_end_of_headers"><code>token::end_of_headers</code></a></p>
</li>
<li>
<p><a href="#token_end_of_body"><code>token::end_of_body</code></a></p>
</li>
<li>
<p><a href="#token_trailer_name"><code>token::trailer_name</code></a></p>
</li>
<li>
<p><a href="#token_trailer_value"><code>token::trailer_value</code></a></p>
</li>
<li>
<p><a href="#token_end_of_message"><code>token::end_of_message</code></a></p>
</li>
<li>
<p><a href="#token_method"><code>token::method</code></a></p>
</li>
<li>
<p><a href="#token_request_target"><code>token::request_target</code></a></p>
</li>
<li>
<p><a href="#token_version"><code>token::version</code></a></p>
</li>
<li>
<p><a href="#token_status_code"><code>token::status_code</code></a></p>
</li>
<li>
<p><a href="#token_reason_phrase"><code>token::reason_phrase</code></a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Structural parsers</p>
<div class="ulist">
<ul>
<li>
<p><a href="#reader_request"><code>reader::request</code></a></p>
</li>
<li>
<p><a href="#reader_response"><code>reader::response</code></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_class_templates">4.1.2. Class Templates</h4>
<div class="ulist">
<ul>
<li>
<p>Content parsers</p>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_chunk_size"><code>syntax::chunk_size</code></a></p>
</li>
<li>
<p><a href="#syntax_content_length"><code>syntax::content_length</code></a></p>
</li>
<li>
<p><a href="#syntax_strict_crlf"><code>syntax::strict_crlf</code></a></p>
</li>
<li>
<p><a href="#syntax_liberal_crlf"><code>syntax::liberal_crlf</code></a></p>
</li>
<li>
<p><a href="#syntax_field_name"><code>syntax::field_name</code></a></p>
</li>
<li>
<p><a href="#syntax_left_trimmed_field_value"><code>syntax::left_trimmed_field_value</code></a></p>
</li>
<li>
<p><a href="#syntax_ows"><code>syntax::ows</code></a></p>
</li>
<li>
<p><a href="#syntax_reason_phrase"><code>syntax::reason_phrase</code></a></p>
</li>
<li>
<p><a href="#syntax_status_code"><code>syntax::status_code</code></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_free_functions">4.1.3. Free Functions</h4>
<div class="ulist">
<ul>
<li>
<p>Header processing</p>
<div class="ulist">
<ul>
<li>
<p><a href="#header_value_any_of"><code>header_value_any_of</code></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_enumerations">4.1.4. Enumerations</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#token_code_value"><code>token::code::value</code></a></p>
</li>
<li>
<p><a href="#token_symbol_value"><code>token::symbol::value</code></a></p>
</li>
<li>
<p><a href="#token_category_value"><code>token::category::value</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_headers">4.1.5. Headers</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#token_header"><code>&lt;boost/http/token.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#header_value_any_of_header"><code>&lt;boost/http/algorithm/header/header_value_any_of.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#reader_request_header"><code>&lt;boost/http/reader/request.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#reader_response_header"><code>&lt;boost/http/reader/response.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_chunk_size_header"><code>&lt;boost/http/syntax/chunk_size.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_content_length_header"><code>&lt;boost/http/syntax/content_length.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_crlf_header"><code>&lt;boost/http/syntax/crlf.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_field_name_header"><code>&lt;boost/http/syntax/field_name.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_field_value_header"><code>&lt;boost/http/syntax/field_value.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_ows_header"><code>&lt;boost/http/syntax/ows.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_reason_phrase_header"><code>&lt;boost/http/syntax/reason_phrase.hpp&gt;</code></a></p>
</li>
<li>
<p><a href="#syntax_status_code_header"><code>&lt;boost/http/syntax/status_code.hpp&gt;</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_detailed">4.2. Detailed</h3>
<div class="sect3">
<h4 id="token_code_value">4.2.1. <code>token::code::value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">code</span>
<span class="tok-p">{</span>
    <span class="tok-k">enum</span> <span class="tok-n">value</span>
    <span class="tok-p">{</span>
        <span class="tok-n">error_insufficient_data</span><span class="tok-p">,</span>
        <span class="tok-n">error_set_method</span><span class="tok-p">,</span>
        <span class="tok-n">error_use_another_connection</span><span class="tok-p">,</span>
        <span class="tok-n">error_invalid_data</span><span class="tok-p">,</span>
        <span class="tok-n">error_no_host</span><span class="tok-p">,</span>
        <span class="tok-n">error_invalid_content_length</span><span class="tok-p">,</span>
        <span class="tok-n">error_content_length_overflow</span><span class="tok-p">,</span>
        <span class="tok-n">error_invalid_transfer_encoding</span><span class="tok-p">,</span>
        <span class="tok-n">error_chunk_size_overflow</span><span class="tok-p">,</span>
        <span class="tok-n">skip</span><span class="tok-p">,</span>
        <span class="tok-n">method</span><span class="tok-p">,</span>
        <span class="tok-n">request_target</span><span class="tok-p">,</span>
        <span class="tok-n">version</span><span class="tok-p">,</span>
        <span class="tok-n">status_code</span><span class="tok-p">,</span>
        <span class="tok-n">reason_phrase</span><span class="tok-p">,</span>
        <span class="tok-n">field_name</span><span class="tok-p">,</span>
        <span class="tok-n">field_value</span><span class="tok-p">,</span>
        <span class="tok-n">end_of_headers</span><span class="tok-p">,</span>
        <span class="tok-n">body_chunk</span><span class="tok-p">,</span>
        <span class="tok-n">end_of_body</span><span class="tok-p">,</span>
        <span class="tok-n">trailer_name</span><span class="tok-p">,</span>
        <span class="tok-n">trailer_value</span><span class="tok-p">,</span>
        <span class="tok-n">end_of_message</span>
    <span class="tok-p">};</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>error_insufficient_data</code></dt>
<dd>
<p><code>token_size()</code> of this token will always be zero.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="token_symbol_value">4.2.2. <code>token::symbol::value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">symbol</span>
<span class="tok-p">{</span>
    <span class="tok-k">enum</span> <span class="tok-n">value</span>
    <span class="tok-p">{</span>
        <span class="tok-n">error</span><span class="tok-p">,</span>

        <span class="tok-n">skip</span><span class="tok-p">,</span>

        <span class="tok-n">method</span><span class="tok-p">,</span>
        <span class="tok-n">request_target</span><span class="tok-p">,</span>
        <span class="tok-n">version</span><span class="tok-p">,</span>
        <span class="tok-n">status_code</span><span class="tok-p">,</span>
        <span class="tok-n">reason_phrase</span><span class="tok-p">,</span>
        <span class="tok-n">field_name</span><span class="tok-p">,</span>
        <span class="tok-n">field_value</span><span class="tok-p">,</span>

        <span class="tok-n">end_of_headers</span><span class="tok-p">,</span>

        <span class="tok-n">body_chunk</span><span class="tok-p">,</span>

        <span class="tok-n">end_of_body</span><span class="tok-p">,</span>

        <span class="tok-n">trailer_name</span><span class="tok-p">,</span>
        <span class="tok-n">trailer_value</span><span class="tok-p">,</span>

        <span class="tok-n">end_of_message</span>
    <span class="tok-p">};</span>

    <span class="tok-k">static</span> <span class="tok-n">value</span> <span class="tok-nf">convert</span><span class="tok-p">(</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_category_value">4.2.3. <code>token::category::value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">category</span>
<span class="tok-p">{</span>
    <span class="tok-k">enum</span> <span class="tok-n">value</span>
    <span class="tok-p">{</span>
        <span class="tok-n">status</span><span class="tok-p">,</span>
        <span class="tok-n">data</span><span class="tok-p">,</span>
        <span class="tok-n">structural</span>
    <span class="tok-p">};</span>

    <span class="tok-k">static</span> <span class="tok-n">value</span> <span class="tok-nf">convert</span><span class="tok-p">(</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span><span class="tok-p">);</span>
    <span class="tok-k">static</span> <span class="tok-n">value</span> <span class="tok-nf">convert</span><span class="tok-p">(</span><span class="tok-n">symbol</span><span class="tok-o">::</span><span class="tok-n">value</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_skip">4.2.4. <code>token::skip</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">skip</span>
<span class="tok-p">{</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">skip</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Used to skip unneeded bytes so user can keep buffer small when asking for more
data.</p>
</div>
</div>
<div class="sect3">
<h4 id="token_field_name">4.2.5. <code>token::field_name</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">field_name</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">field_name</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_field_value">4.2.6. <code>token::field_value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">field_value</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">field_value</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_body_chunk">4.2.7. <code>token::body_chunk</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">body_chunk</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">const_buffer</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">body_chunk</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_end_of_headers">4.2.8. <code>token::end_of_headers</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">end_of_headers</span>
<span class="tok-p">{</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_headers</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_end_of_body">4.2.9. <code>token::end_of_body</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">end_of_body</span>
<span class="tok-p">{</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_body</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_trailer_name">4.2.10. <code>token::trailer_name</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">trailer_name</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">trailer_name</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This token is “implicitly convertible” to <code>field_name</code>, so to speak. In other
words, you can treat it as <code>field_name</code> at value extraction time (i.e. the
<code>reader::{request,response}::value&lt;T&gt;()</code> function).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="token_trailer_value">4.2.11. <code>token::trailer_value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">trailer_value</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">trailer_value</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This token is “implicitly convertible” to <code>field_value</code>, so to speak. In other
words, you can treat it as <code>field_value</code> at value extraction time (i.e. the
<code>reader::{request,response}::value&lt;T&gt;()</code> function).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="token_end_of_message">4.2.12. <code>token::end_of_message</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">end_of_message</span>
<span class="tok-p">{</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">end_of_message</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_method">4.2.13. <code>token::method</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">method</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">method</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_request_target">4.2.14. <code>token::request_target</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">request_target</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">request_target</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_version">4.2.15. <code>token::version</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">version</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-kt">int</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">version</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_status_code">4.2.16. <code>token::status_code</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">status_code</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-kt">uint_least16_t</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">status_code</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_reason_phrase">4.2.17. <code>token::reason_phrase</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/token.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">token</span> <span class="tok-p">{</span>

<span class="tok-k">struct</span> <span class="tok-n">reason_phrase</span>
<span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">string_ref</span> <span class="tok-n">type</span><span class="tok-p">;</span>
    <span class="tok-k">static</span> <span class="tok-k">const</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">value</span> <span class="tok-n">code</span> <span class="tok-o">=</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">code</span><span class="tok-o">::</span><span class="tok-n">reason_phrase</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace token</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reader_request">4.2.18. <code>reader::request</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/reader/request.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class represents an <code>HTTP/1.1</code> (and <code>HTTP/1.0</code>) incremental parser. It&#8217;ll
use the token definitions found in <a href="#token_code_value"><code>token::code::value</code></a>.
You may want to check the <a href="#parsing_tutorial1">basic parsing tutorial</a> to learn
the basics.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Once the parser enters in an error state (<strong>and</strong> the error is different than
<code>token::code::error_insufficient_data</code>), the internal buffer is said to be in an
invalidated state. Therefore, the parser won&#8217;t access the data anymore and the
user is free to invalidate the data (e.g. resize/free it) without calling
<code>set_buffer()</code> or <code>reset()</code> first.</p>
</div>
<div class="paragraph">
<p>If you want to reuse the same reader object to parse another stream, just call
<code>reset()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_member_types">4.2.18.1. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef std::size_t size_type</code></dt>
<dd>
<p>Type used to represent sizes.</p>
</dd>
<dt class="hdlist1"><code>typedef const char value_type</code></dt>
<dd>
<p>Type used to represent the value of a single element in the buffer.</p>
</dd>
<dt class="hdlist1"><code>typedef value_type *pointer</code></dt>
<dd>
<p>Pointer-to-value type.</p>
</dd>
<dt class="hdlist1"><code>typedef boost::string_ref view_type</code></dt>
<dd>
<p>Type used to refer to non-owning string slices.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions">4.2.18.2. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>request()</code></dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>void reset()</code></dt>
<dd>
<p>After a call to this function, the object has the same internal state as an
object that was just constructed.</p>
</dd>
<dt class="hdlist1"><code>token::code::value code() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns code.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following values are <strong>never</strong> returned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::code::error_set_method</code>.</p>
</li>
<li>
<p><code>token::code::error_use_another_connection</code>.</p>
</li>
<li>
<p><code>token::code::status_code</code>.</p>
</li>
<li>
<p><code>token::code::reason_phrase</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>token::symbol::value symbol() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns symbol.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following values are <strong>never</strong> returned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::symbol::status_code</code>.</p>
</li>
<li>
<p><code>token::symbol::reason_phrase</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>token::category::value category() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns category.</p>
</dd>
<dt class="hdlist1"><code>size_type token_size() const</code></dt>
<dd>
<p>Returns the size of current token.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After you call <code>next()</code>, you&#8217;re free to remove, from the buffer, the amount of
bytes equals to the value returned here.</p>
</div>
<div class="paragraph">
<p>If you do remove the parsed data from the buffer, the address of the data
shouldn&#8217;t change (i.e. you must not invalidate the pointers/iterators to old
unparsed data). If you do change the address of old unparsed data, call
<code>set_buffer</code> before using this object again.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
<span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do <strong>not</strong> use <code>string_length(reader.value&lt;T&gt;())</code> to compute the token
size. <code>string_length(reader.value&lt;T&gt;())</code> and <code>reader.token_size()</code> may
differ. <a href="#parsing_tutorial2">Check the advanced parsing tutorial for more
details</a>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>template&lt;class T&gt; typename T::type value() const</code></dt>
<dd>
<p>Extracts the value of current token and returns it.</p>
<div class="paragraph">
<p><code>T</code> must be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::method</code>.</p>
</li>
<li>
<p><code>token::request_target</code>.</p>
</li>
<li>
<p><code>token::version</code>.</p>
</li>
<li>
<p><code>token::field_name</code>.</p>
</li>
<li>
<p><code>token::field_value</code>.</p>
</li>
<li>
<p><code>token::body_chunk</code>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>assert(code() == T::code)</code> precondition is assumed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This parser doesn&#8217;t buffer data. The value is extracted directly from
buffer.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>token::code::value expected_token() const</code></dt>
<dd>
<p>Returns the expected token code.</p>
<div class="paragraph">
<p>Useful when the buffer has been exhausted and <code>code() ==
token::code::error_insufficient_data</code>. Use it to respond with
“URL/HTTP-header/&#8230;&#8203; too long” or another error-handling strategy.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The returned value is a <strong>heuristic</strong>, not a <em>truth</em>. If your buffer is too small,
the buffer will be exhausted with too little info to know which element is
expected for sure.</p>
</div>
<div class="paragraph">
<p>For instance, <code>expected_token()</code> might return <code>token::code::field_name</code>, but
when you have enough info in the buffer, the actual token happens to be
<code>token::code::end_of_headers</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>void next()</code></dt>
<dd>
<p>Consumes the current token and advances in the buffer.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Given the current token is complete (i.e. <code>code() !=
token::code::error_insufficient_data</code>), a call to this function <strong>always</strong>
consumes the current token.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>void set_buffer(asio::const_buffer inbuffer)</code></dt>
<dd>
<p>Sets buffer to <em>inbuffer</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><em>inbuffer</em> should hold the data at the same point of unparsed data from the
internal buffer from before this call.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>

<span class="tok-c1">// now unparsed data becomes ahead</span>
<span class="tok-c1">// of `buffer.begin()`</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>

<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span> <span class="tok-o">+</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The reader object follows the HTTP stream orchestrated by the
continuous flow of <code>set_buffer()</code> and <code>next()</code>. You should treat this region as
read-only. For instance, if I pass <code>"header-a: something"</code> to the reader and
then change the contents to <code>"header-a: another thing"</code>, there are no guarantees
about the reader object behaviour. You can safely change only the contents of
the buffer region not yet exposed to <code>reader</code> through
<code>reader.set_buffer(some_buffer)</code> (i.e. the region outside of <code>some_buffer</code> never
seen by <code>reader</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You&#8217;re free to pass larger buffers at will.</p>
</div>
<div class="paragraph">
<p>You&#8217;re also free to pass a buffer just as big as current token
(i.e. <code>token_size()</code>). In other words, you&#8217;re free to shrink the buffer <strong>if</strong> the
new buffer is at least as big as current token.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to free the buffer while maintaining the reader object valid, just
set the buffer to current token size, call <code>next()</code> and then set buffer to an
empty buffer.</p>
</div>
<div class="paragraph">
<p>Do notice that this will consume current token as well. And as values are
decoded directly from the buffer, this strategy is the only choice.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">,</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">()));</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">const_buffer</span><span class="tok-p">());</span>
<span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>size_type parsed_count() const</code></dt>
<dd>
<p>Returns the number of bytes parsed <strong>since <code>set_buffer</code> was last called</strong>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use it to go away with the <code>nparsed</code> variable shown in the
<a href="#parsing_tutorial1">principles on parsing tutorial</a>. I&#8217;m sorry about the “<em>you
must keep track of the number of discarded bytes</em>” lie I told you before, but as
<a href="https://channel9.msdn.com/Shows/Going+Deep/Cpp-and-Beyond-2012-Scott-Meyers-Universal-References-in-Cpp11">one
great explainer once told</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>As I look upon you&#8230;&#8203; it occurs to me that you may not have the necessary level
of maturity to handle the truth.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Scott Meyers<br>
<cite>C++ and Beyond 2012: Universal References in C++11</cite>
</div>
</div>
<div class="paragraph">
<p>That lie was useful to explain some core concepts behind this library.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also">4.2.18.3. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request_response_diff">What are the differences between <code>reader::request</code> and
<code>reader::response</code>?</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reader_response">4.2.19. <code>reader::response</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/reader/response.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class represents an <code>HTTP/1.1</code> (and <code>HTTP/1.0</code>) incremental parser. It&#8217;ll
use the token definitions found in <a href="#token_code_value"><code>token::code::value</code></a>.
You may want to check the <a href="#parsing_tutorial1">basic parsing tutorial</a> to learn
the basics.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Once the parser enters in an error state (<strong>and</strong> the error is different than
<code>token::code::error_insufficient_data</code>), the internal buffer is said to be in an
invalidated state. Therefore, the parser won&#8217;t access the data anymore and the
user is free to invalidate the data (e.g. resize/free it) without calling
<code>set_buffer()</code> or <code>reset()</code> first.</p>
</div>
<div class="paragraph">
<p>If you want to reuse the same reader object to parse another stream, just call
<code>reset()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_member_types_2">4.2.19.1. Member types</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>typedef std::size_t size_type</code></dt>
<dd>
<p>Type used to represent sizes.</p>
</dd>
<dt class="hdlist1"><code>typedef const char value_type</code></dt>
<dd>
<p>Type used to represent the value of a single element in the buffer.</p>
</dd>
<dt class="hdlist1"><code>typedef value_type *pointer</code></dt>
<dd>
<p>Pointer-to-value type.</p>
</dd>
<dt class="hdlist1"><code>typedef boost::string_ref view_type</code></dt>
<dd>
<p>Type used to refer to non-owning string slices.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_member_functions_2">4.2.19.2. Member functions</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>response()</code></dt>
<dd>
<p>Constructor.</p>
</dd>
<dt class="hdlist1"><code>void set_method(view_type method)</code></dt>
<dd>
<p>Use it to inform the request method of the request message associated with
this response message. This is necessary internally to compute the body
size. If you do not call this function when <code>code() ==
token::code::status_code</code>, then <code>token::code::error_set_method</code> will be the
next token.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>assert(code() == token::code::status_code)</code> precondition is
assumed.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>void reset()</code></dt>
<dd>
<p>After a call to this function, the object has the same internal state as an
object that was just constructed.</p>
</dd>
<dt class="hdlist1"><code>void puteof()</code></dt>
<dd>
<p>If the connection is closed, call this function. <code>HTTP/1.0</code> used this event to
signalize <code>token::code::end_of_body</code>.</p>
</dd>
<dt class="hdlist1"><code>token::code::value code() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns code.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following values are <strong>never</strong> returned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::code::error_no_host</code>.</p>
</li>
<li>
<p><code>token::code::method</code>.</p>
</li>
<li>
<p><code>token::code::request_target</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>token::symbol::value symbol() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns symbol.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following values are <strong>never</strong> returned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::symbol::method</code>.</p>
</li>
<li>
<p><code>token::symbol::request_target</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>token::category::value category() const</code></dt>
<dd>
<p>Use it to inspect current token. Returns category.</p>
</dd>
<dt class="hdlist1"><code>size_type token_size() const</code></dt>
<dd>
<p>Returns the size of current token.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After you call <code>next()</code>, you&#8217;re free to remove, from the buffer, the amount of
bytes equals to the value returned here.</p>
</div>
<div class="paragraph">
<p>If you do remove the parsed data from the buffer, the address of the data
shouldn&#8217;t change (i.e. you must not invalidate the pointers/iterators to old
unparsed data). If you do change the address of old unparsed data, call
<code>set_buffer</code> before using this object again.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
<span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">erase</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do <strong>not</strong> use <code>string_length(reader.value&lt;T&gt;())</code> to compute the token
size. <code>string_length(reader.value&lt;T&gt;())</code> and <code>reader.token_size()</code> may
differ. <a href="#parsing_tutorial2">Check the advanced parsing tutorial for more
details</a>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>template&lt;class T&gt; typename T::type value() const</code></dt>
<dd>
<p>Extracts the value of current token and returns it.</p>
<div class="paragraph">
<p><code>T</code> must be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>token::status_code</code>.</p>
</li>
<li>
<p><code>token::version</code>.</p>
</li>
<li>
<p><code>token::reason_phrase</code>.</p>
</li>
<li>
<p><code>token::field_name</code>.</p>
</li>
<li>
<p><code>token::field_value</code>.</p>
</li>
<li>
<p><code>token::body_chunk</code>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The <code>assert(code() == T::code)</code> precondition is assumed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This parser doesn&#8217;t buffer data. The value is extracted directly from
buffer.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>token::code::value expected_token() const</code></dt>
<dd>
<p>Returns the expected token code.</p>
<div class="paragraph">
<p>Useful when the buffer has been exhausted and <code>code() ==
token::code::error_insufficient_data</code>. Use it to log error to <em>cout</em> or another
error-handling strategy.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The returned value is a <strong>heuristic</strong>, not a <em>truth</em>. If your buffer is too small,
the buffer will be exhausted with too little info to know which element is
expected for sure.</p>
</div>
<div class="paragraph">
<p>For instance, <code>expected_token()</code> might return <code>token::code::field_name</code>, but
when you have enough info in the buffer, the actual token happens to be
<code>token::code::end_of_headers</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>void next()</code></dt>
<dd>
<p>Consumes the current token and advances in the buffer.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Given the current token is complete (i.e. <code>code() !=
token::code::error_insufficient_data</code>), a call to this function <strong>always</strong>
consumes the current token.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>void set_buffer(asio::const_buffer inbuffer)</code></dt>
<dd>
<p>Sets buffer to <em>inbuffer</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><em>inbuffer</em> should hold the data at the same point of unparsed data from the
internal buffer from before this call.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">nparsed</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">();</span>

<span class="tok-c1">// now unparsed data becomes ahead</span>
<span class="tok-c1">// of `buffer.begin()`</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>

<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span> <span class="tok-o">+</span> <span class="tok-n">nparsed</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The reader object follows the HTTP stream orchestrated by the
continuous flow of <code>set_buffer()</code> and <code>next()</code>. You should treat this region as
read-only. For instance, if I pass <code>"header-a: something"</code> to the reader and
then change the contents to <code>"header-a: another thing"</code>, there are no guarantees
about the reader object behaviour. You can safely change only the contents of
the buffer region not yet exposed to <code>reader</code> through
<code>reader.set_buffer(some_buffer)</code> (i.e. the region outside of <code>some_buffer</code> never
seen by <code>reader</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You&#8217;re free to pass larger buffers at will.</p>
</div>
<div class="paragraph">
<p>You&#8217;re also free to pass a buffer just as big as current token
(i.e. <code>token_size()</code>). In other words, you&#8217;re free to shrink the buffer <strong>if</strong> the
new buffer is at least as big as current token.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to free the buffer while maintaining the reader object valid, just
set the buffer to current token size, call <code>next()</code> and then set buffer to an
empty buffer.</p>
</div>
<div class="paragraph">
<p>Do notice that this will consume current token as well. And as values are
decoded directly from the buffer, this strategy is the only choice.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">buffer</span><span class="tok-p">(</span><span class="tok-n">buffer</span><span class="tok-p">,</span> <span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">token_size</span><span class="tok-p">()));</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">();</span>
<span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-n">set_buffer</span><span class="tok-p">(</span><span class="tok-n">boost</span><span class="tok-o">::</span><span class="tok-n">asio</span><span class="tok-o">::</span><span class="tok-n">const_buffer</span><span class="tok-p">());</span>
<span class="tok-n">buffer</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>size_type parsed_count() const</code></dt>
<dd>
<p>Returns the number of bytes parsed <strong>since <code>set_buffer</code> was last called</strong>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use it to go away with the <code>nparsed</code> variable shown in the
<a href="#parsing_tutorial1">principles on parsing tutorial</a>. I&#8217;m sorry about the “<em>you
must keep track of the number of discarded bytes</em>” lie I told you before, but as
<a href="https://channel9.msdn.com/Shows/Going+Deep/Cpp-and-Beyond-2012-Scott-Meyers-Universal-References-in-Cpp11">one
great explainer once told</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>As I look upon you&#8230;&#8203; it occurs to me that you may not have the necessary level
of maturity to handle the truth.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Scott Meyers<br>
<cite>C++ and Beyond 2012: Universal References in C++11</cite>
</div>
</div>
<div class="paragraph">
<p>That lie was useful to explain some core concepts behind this library.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_2">4.2.19.3. See also</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#request_response_diff">What are the differences between <code>reader::request</code> and
<code>reader::response</code>?</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_chunk_size">4.2.20. <code>syntax::chunk_size</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/chunk_size.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">chunk_size</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_BEGIN</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">invalid</span><span class="tok-p">,</span>
        <span class="tok-n">ok</span><span class="tok-p">,</span>
        <span class="tok-n">overflow</span>
    <span class="tok-p">}</span>
    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_END</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>

    <span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Target</span><span class="tok-o">&gt;</span>
    <span class="tok-k">static</span> <span class="tok-n">result</span> <span class="tok-n">decode</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">in</span><span class="tok-p">,</span> <span class="tok-n">Target</span> <span class="tok-o">&amp;</span><span class="tok-n">out</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_content_length">4.2.21. <code>syntax::content_length</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/content_length.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">content_length</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_BEGIN</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">invalid</span><span class="tok-p">,</span>
        <span class="tok-n">ok</span><span class="tok-p">,</span>
        <span class="tok-n">overflow</span>
    <span class="tok-p">}</span>
    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_END</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>

    <span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">Target</span><span class="tok-o">&gt;</span>
    <span class="tok-k">static</span> <span class="tok-n">result</span> <span class="tok-n">decode</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">in</span><span class="tok-p">,</span> <span class="tok-n">Target</span> <span class="tok-o">&amp;</span><span class="tok-n">out</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_strict_crlf">4.2.22. <code>syntax::strict_crlf</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/crlf.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">strict_crlf</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_liberal_crlf">4.2.23. <code>syntax::liberal_crlf</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/crlf.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">liberal_crlf</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_BEGIN</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">crlf</span><span class="tok-p">,</span>
        <span class="tok-n">lf</span><span class="tok-p">,</span>
        <span class="tok-n">insufficient_data</span><span class="tok-p">,</span>
        <span class="tok-n">invalid_data</span><span class="tok-p">,</span>
    <span class="tok-p">}</span>
    <span class="tok-n">BOOST_SCOPED_ENUM_DECLARE_END</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">)</span>

    <span class="tok-k">static</span> <span class="tok-n">result</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_field_name">4.2.24. <code>syntax::field_name</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/field_name.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">field_name</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_left_trimmed_field_value">4.2.25. <code>syntax::left_trimmed_field_value</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/field_value.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">left_trimmed_field_value</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_ows">4.2.26. <code>syntax::ows</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/ows.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">ows</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_reason_phrase">4.2.27. <code>syntax::reason_phrase</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/reason_phrase.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">reason_phrase</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="syntax_status_code">4.2.28. <code>syntax::status_code</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/syntax/status_code.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">namespace</span> <span class="tok-n">syntax</span> <span class="tok-p">{</span>

<span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">CharT</span><span class="tok-o">&gt;</span>
<span class="tok-k">struct</span> <span class="tok-n">status_code</span> <span class="tok-p">{</span>
    <span class="tok-k">typedef</span> <span class="tok-n">basic_string_ref</span><span class="tok-o">&lt;</span><span class="tok-n">CharT</span><span class="tok-o">&gt;</span> <span class="tok-n">view_type</span><span class="tok-p">;</span>

    <span class="tok-k">static</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-kt">size_t</span> <span class="tok-n">match</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>

    <span class="tok-k">static</span> <span class="tok-kt">uint_least16_t</span> <span class="tok-nf">decode</span><span class="tok-p">(</span><span class="tok-n">view_type</span> <span class="tok-n">view</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-p">}</span> <span class="tok-c1">// namespace syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header_value_any_of">4.2.29. <code>header_value_any_of</code></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;boost/http/algorithm/header/header_value_any_of.hpp&gt;</span><span class="tok-cp"></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-o">&lt;</span><span class="tok-k">class</span> <span class="tok-nc">StringRef</span><span class="tok-p">,</span> <span class="tok-k">class</span> <span class="tok-nc">Predicate</span><span class="tok-o">&gt;</span>
<span class="tok-kt">bool</span> <span class="tok-n">header_value_any_of</span><span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">StringRef</span> <span class="tok-o">&amp;</span><span class="tok-n">header_value</span><span class="tok-p">,</span> <span class="tok-k">const</span> <span class="tok-n">Predicate</span> <span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Checks if unary predicate <em>p</em> returns <code>true</code> for at least one element from the
comma-separated list defined by the <em>header_value</em> HTTP field value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This algorithm is liberal in what it accepts and it will skip invalid
elements. An invalid element is a sequence, possibly empty, containing no other
character than optional white space (i.e. <code>'\x20'</code> or <code>'\t'</code>).
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_template_parameters">4.2.29.1. Template parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>StringRef</code></dt>
<dd>
<p>It MUST fulfill the requirements of the <code>StringRef</code> concept
(i.e. <code>boost::basic_string_ref</code>).</p>
</dd>
<dt class="hdlist1"><code>Predicate</code></dt>
<dd>
<p>A type whose instances are callable and have the following signature:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-kt">bool</span><span class="tok-p">(</span><span class="tok-n">StringRef</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_parameters">4.2.29.2. Parameters</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>const StringRef &amp;header_value</code></dt>
<dd>
<p>The HTTP field value.</p>
</dd>
<dt class="hdlist1"><code>const Predicate &amp;p</code></dt>
<dd>
<p>The functor predicate that will be called for the elements found on the
comma-separated list.</p>
<div class="paragraph">
<p>Optional white space (only at the beginning and at the end) is trimmed before
applying the element to <em>p</em>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_return_value">4.2.29.3. Return value</h5>
<div class="paragraph">
<p><code>true</code> if the <em>p</em> returns <code>true</code> for at least one element from the list and
<code>false</code> otherwise. This also means that you&#8217;ll get the return value <code>false</code> for
empty lists.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token_header">4.2.30. <code>&lt;boost/http/token.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#token_code_value"><code>token::code::value</code></a></p>
</li>
<li>
<p><a href="#token_symbol_value"><code>token::symbol::value</code></a></p>
</li>
<li>
<p><a href="#token_category_value"><code>token::category::value</code></a></p>
</li>
<li>
<p><a href="#token_skip"><code>token::skip</code></a></p>
</li>
<li>
<p><a href="#token_field_name"><code>token::field_name</code></a></p>
</li>
<li>
<p><a href="#token_field_value"><code>token::field_value</code></a></p>
</li>
<li>
<p><a href="#token_body_chunk"><code>token::body_chunk</code></a></p>
</li>
<li>
<p><a href="#token_end_of_headers"><code>token::end_of_headers</code></a></p>
</li>
<li>
<p><a href="#token_end_of_body"><code>token::end_of_body</code></a></p>
</li>
<li>
<p><a href="#token_end_of_message"><code>token::end_of_message</code></a></p>
</li>
<li>
<p><a href="#token_method"><code>token::method</code></a></p>
</li>
<li>
<p><a href="#token_request_target"><code>token::request_target</code></a></p>
</li>
<li>
<p><a href="#token_version"><code>token::version</code></a></p>
</li>
<li>
<p><a href="#token_status_code"><code>token::status_code</code></a></p>
</li>
<li>
<p><a href="#token_reason_phrase"><code>token::reason_phrase</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="header_value_any_of_header">4.2.31. <code>&lt;boost/http/algorithm/header/header_value_any_of.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#header_value_any_of"><code>header_value_any_of</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reader_request_header">4.2.32. <code>&lt;boost/http/reader/request.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reader_request"><code>reader::request</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reader_response_header">4.2.33. <code>&lt;boost/http/reader/response.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reader_response"><code>reader::response</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_chunk_size_header">4.2.34. <code>&lt;boost/http/syntax/chunk_size.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_chunk_size"><code>syntax::chunk_size</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_content_length_header">4.2.35. <code>&lt;boost/http/syntax/content_length.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_content_length"><code>syntax::content_length</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_crlf_header">4.2.36. <code>&lt;boost/http/syntax/crlf.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_strict_crlf"><code>syntax::strict_crlf</code></a></p>
</li>
<li>
<p><a href="#syntax_liberal_crlf"><code>syntax::liberal_crlf</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_field_name_header">4.2.37. <code>&lt;boost/http/syntax/field_name.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_field_name"><code>syntax::field_name</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_field_value_header">4.2.38. <code>&lt;boost/http/syntax/field_value.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_left_trimmed_field_value"><code>syntax::left_trimmed_field_value</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_ows_header">4.2.39. <code>&lt;boost/http/syntax/ows.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_ows"><code>syntax::ows</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_reason_phrase_header">4.2.40. <code>&lt;boost/http/syntax/reason_phrase.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_reason_phrase"><code>syntax::reason_phrase</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="syntax_status_code_header">4.2.41. <code>&lt;boost/http/syntax/status_code.hpp&gt;</code></h4>
<div class="paragraph">
<p>Import the following symbols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#syntax_status_code"><code>syntax::status_code</code></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. parser combinators algorithms are on the way to ease it up even further. <a href="https://vimeo.com/171704565">Check the talk from Scott Wlaschin for more</a>.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. The larger explanation being: incomplete tokens are kept in buffer, so you are not required to allocate them on a secondary buffer, but you&#8217;re still allowed to mutate/move/grow the buffer (as opposed to&#8230;&#8203; say&#8230;&#8203; some C++ iterators that would get invalidated once the container changes).
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. parsing is done one token at a time no matter how much data is buffered
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. Proper extraction of header fields (some popular parsers like NodeJS&#8217;s will force you to know protocol details and parser internals to manually remove leading and trailing whitespace from field values). This point is not only about header field extraction, but really about a parser that indeed abstract and understand the protocol and that is easy to use right by people that don&#8217;t know HTTP.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. for tests
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. For the documentation.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. If I continue to develop the Boost.Http&#8217;s message framework, that&#8217;s the solution that will be adopted to this particular problem.
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. Consult Occam&#8217;s razor.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-01-08 23:44:05 -03
</div>
</div>
</body>
</html>